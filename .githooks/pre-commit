#!/bin/bash
# =============================================================================  
# Git Pre-commit Hook - Universal Quality Gate (Language Independent)
# =============================================================================
# This runs automatically before every git commit to ensure code quality.
# Works with any language through standardized Docker containers and Make targets.
# Install: git config core.hooksPath .githooks

set -e

echo "ğŸ” Running universal pre-commit quality checks..."

# Check if there are any changes staged for commit
if ! git diff --cached --quiet; then
    echo "ğŸ“‹ Changes detected, running validation..."
    
    # Use the universal Makefile interface for testing
    # This works with Python, Node.js, Clojure, or any Docker-based project
    echo "ğŸ§ª Running language-independent test suite..."
    
    if make ci-test >/dev/null 2>&1; then
        echo "âœ… All tests passed"
    else
        echo "âŒ Tests failed! Commit aborted."
        echo "ğŸ’¡ Run 'make test' locally to see detailed error output"
        exit 1
    fi
else
    echo "ğŸ“‹ No changes staged for commit"
fi

echo "âœ… All quality checks passed - commit proceeding"