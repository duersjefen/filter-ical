name: Find Nginx Setup
on:
  workflow_dispatch:

jobs:
  find:
    runs-on: ubuntu-latest
    steps:
      - name: 🔍 Find How Nginx is Deployed
        uses: appleboy/ssh-action@v1.0.3
        with:
          host: ${{ secrets.EC2_HOST }}
          username: ${{ secrets.EC2_USER }}
          key: ${{ secrets.EC2_SSH_KEY }}
          script: |
            echo "🔍 Looking for nginx container:"
            docker ps -a | grep nginx || echo "No nginx containers found"

            echo ""
            echo "🔍 Checking docker-compose files:"
            find /opt/websites -name "*.yml" -o -name "*.yaml" | xargs ls -lah

            echo ""
            echo "🔍 Checking if nginx is in docker-compose:"
            cd /opt/websites && docker-compose config --services 2>&1 | grep -i nginx || echo "Nginx not in compose services"

            echo ""
            echo "🔍 Checking nginx mount (if running):"
            docker inspect websites-nginx 2>/dev/null | grep -A 10 "Mounts" || echo "Container not found or not inspectable"